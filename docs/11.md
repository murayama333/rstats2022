# `apply` 関数

* Rは関数の引数や戻り値に関数を指定できる（高階関数）
* 名前のない関数（無名関数）を定義して利用することもできる
* `apply` 関数などを使うとデータフレームなど集合データに任意の対して関数を適用できる

> `R` には `apply` 関数以外にも `lapply` 関数や `sapply` 関数などの関数が用意されています。これらの関数を上手く使うことで短いコードで多くの処理を実現できます。

---

## `apply` 関数による関数の適用

* `apply` 関数によって配列や行列、データフレームに対して任意の関数を適用できる
* `apply` 関数は第1引数（`X`）に対象データ、第2引数（`MARGIN`）に関数を適用する方向（`1`の場合横方向（行単位）、`2`の場合縦方向（列））、第3引数（`FUN`）に適用する関数を指定する
* 第2引数の `MARGIN` に `c(1, 2)` と指定すると個々のデータに対して関数を適用できる


### `fn1.R`

``` r
df <- data.frame(
  x = c(1, 2, 3),
  y = c(10, 20, 30),
  z = c(100, 200, 300)
)
apply(df, 1, sum) 
apply(df, 2, max) 
apply(df, c(1, 2), function(x) x ** 2)
```

> 最後の行のプログラムでは `function` キーワードを使ってその場で関数を定義しています。このような名前のない関数は無名関数などと呼ばれます。

### 実行結果

``` r
> df <- data.frame(
+   x = c(1, 2, 3),
+   y = c(10, 20, 30),
+   z = c(100, 200, 300)
+ )
> apply(df, 1, sum) 
[1] 111 222 333
> apply(df, 2, max) 
  x   y   z 
  3  30 300 
> apply(df, c(1, 2), function(x) x ** 2)
     x   y     z
[1,] 1 100 10000
[2,] 4 400 40000
[3,] 9 900 90000
```

---

## `lapply` 関数による関数の適用

* `lapply` 関数はリストデータやベクトルデータに対して任意の関数を適用する
* `lapply` 関数は第1引数（ `X` ）にリストデータ、第2引数（ `FUN` ） に適用する関数を指定する（戻り値はリスト型になる点に注意する）
* `sapply` 関数も同様にリストデータに関数を適用できるが、戻り値がベクトルになる点が異なる

### `fn2.R`

``` r
ls <- list(
  a = c(1, 2, 3),
  b = c(10, 20, 30, 40),
  c = c(100, 200, 300, 400, 500)
)
lapply(ls, max)
sapply(ls, max)
```

### 実行結果

``` r
> ls <- list(
+   a = c(1, 2, 3),
+   b = c(10, 20, 30, 40),
+   c = c(100, 200, 300, 400, 500)
+ )
> lapply(ls, max)
$a
[1] 3

$b
[1] 40

$c
[1] 500

> sapply(ls, max)
  a   b   c 
  3  40 500 
```

---

## `mapply` 関数による関数の適用

* `mapply` 関数は複数のリストデータやベクトルデータに対して任意の関数を適用する
* `mapply` 関数は第1引数（ `FUN` ）に 第2引数以降に関数を適用するベクトルデータを指定する（可変長引数）
* `mapply` 関数は `sapply` 関数の引数（対象データ）を増やしたものとして利用できる

### `fn3.R`

``` r
x <- c(1, 2, 3)
y <- c(10, 20, 30)
mapply(function(e1, e2) e1 + e2, x, y) 
```

### 実行結果

``` r
> x <- c(1, 2, 3)
> y <- c(10, 20, 30)
> mapply(function(e1, e2) e1 + e2, x, y) 
[1] 11 22 33
```

---

## `tapply` 関数による関数の適用

* `tapply` 関数はデータフレームなどを分割して任意の関数を適用する
* `tapply` 関数は第1引数（ `X` ）に対象データ、第2引数（ `INDEX` ）に分割基準となるデータ、第3引数（ `FUN` ）に適用する関数を指定する

### `fn4.R`

``` r
df <- data.frame(
  category = c("A", "B", "A", "B", "A"),
  count = c(1, 2, 3, 4, 5)
)
tapply(df$count, df$category, sum)
```

### 実行結果

``` r
> df <- data.frame(
+   category = c("A", "B", "A", "B", "A"),
+   count = c(1, 2, 3, 4, 5)
+ )
> tapply(df$count, df$category, sum)
A B 
9 6 
```

---
