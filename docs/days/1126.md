# カイ二乗分布

* 標準正規分布に従う母集団から、サンプルサイズ10の標本を取得する
* 標本からカイ二乗値を求める
* 上記の計算を1000回シミュレーションする

```r
x <- numeric(1000)
for (i in 1:1000) {
  sample <- rnorm(10)
  #sample <- rnorm(10, mean=100, sd=10)
  #sample <- (sample - mean(sample)) / 10
  x[i] <- sum(sample^2)  
}
hist(x, freq = F)
curve(dchisq(x, df=10), add = T)
```

---

## 統計量：カイ二乗値

* 標準正規分布に従う確率変数

$$
x_i\sim N(0, 1)
$$

* 標準正規分布に従う複数の独立した確率変数の2乗和は、カイ二乗分布に従う

$$
\chi^2 = \sum_{i=1}^n {x_i}^2 \sim \chi^2(\nu=n)
$$

* 母集団が標準正規分布出ない場合でも、標準化すればよい

$$
\chi^2 = \sum_{i=1}^n (\frac{{x_i} - \mu}{\sigma})^2 \sim \chi^2(\nu=n)
$$

> ここでは未知の値である母平均`μ`と母標準偏差`σ`が出現している点に注目します。母平均を`μ`を標本平均`x-`に置き換えると自由度がn-1のカイ二乗分布に従うことが知られています。

* 標本平均を使ったカイ二乗値は自由度n-1のカイ二乗分布に従う

$$
\chi^2 = \sum_{i=1}^n (\frac{{x_i} - \bar{x}}{\sigma})^2 \sim \chi^2(\nu=n-1)
$$

> ここで未知の値は母標準偏差`σ`だけになる点に注目します。その他の変数はサンプルから計算できる統計量であるため、カイ二乗分布を使って母分散（母標準偏差`σ`）の区間推定が可能となります。

* 上記の計算式は、不偏分散の計算式とよく似ている

$$
s^2 = \frac{1}{n-1}\sum_{i=1}^n (x_i - \bar{x})^2
$$

* 不偏分散の式の両辺に(n - 1)を掛ける - ①

$$
(n-1)s^2 = \sum_{i=1}^n (x_i - \bar{x})^2
$$

* カイ二乗値の計算式のσ^2をΣの前に出す - ②


$$
\chi^2 = \frac{1}{\sigma^2}\sum_{i=1}^n ({x_i} - \bar{x})^2
$$

* ①②より、カイ二乗値は不偏分散を使って以下のように計算できる

$$
\chi^2 = \frac{(n-1)s^2}{\sigma^2} \sim \chi^2(\nu = n -1)
$$

---

## カイ二乗分布の利用シーン

* 母分散の区間推定（仮設検定）に使う。たとえば95%信頼区間の場合

$$
\chi_{0.025}(\nu) \le \chi^2 \le \chi_{0.975}(\nu) 
$$

* カイ二乗値の計算式を当てはめると次のようになる

$$
\chi_{0.025}(\nu) \le \frac{(n-1)s^2}{\sigma^2} \le \chi_{0.975}(\nu) 
$$


* 自由度9のカイ二乗分布の95%信頼区間は以下のようになる

```r
qchisq(0.025, df = 9) #=> 2.700389
qchisq(0.975, df = 9) #=> 19.02277
```

$$
2.70 \le \frac{(n-1)s^2}{\sigma^2} \le 19.02
$$

* （n-1）s^2 で割る

$$
\frac{2.70}{ (n-1)s^2} \le \frac{1}{\sigma^2} \le \frac{19.02}{(n-1)s^2}
$$

* 分母分子を置き換える（不等号は反対になる）

$$
\frac{(n-1)s^2}{2.70} \ge \sigma^2 \ge \frac{(n-1)s^2}{19.02}
$$

* 左辺と右辺を入れ替える

$$
\frac{(n-1)s^2}{19.02}  \le \sigma^2 \le\frac{(n-1)s^2}{2.70} 
$$


> 他にもカイ二乗検定（適合度検定、独立性の検定）に利用することもあります。