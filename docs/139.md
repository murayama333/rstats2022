# 仮説検定 - 適合度検定（カイ二乗検定）

||男性|女性|
|:--:|:--:|:--:|
|度数（観測値）|42|58|

* 度数分布表の理論値に比べて観測値（実測値）が妥当かどうかを検定する
* 適合度検定はカイ二乗分布を使って（近似して）仮説検定を行う
* 帰無仮説（H0）は理論値と実測値に差がないこと

---

## カイ二乗値の求め方

* `O` を観測値、`E` を理論値とおくと以下の式で求めた値は自由度 N のカイ二乗分布に従う

  <img src="img/530.png?" width="280px">

> 自由度は度数分布表のカテゴリー数 - 1 となります。

---

## 例： アンケート調査

* 街頭で無作為に100人のアンケート調査を行った。アンケート調査の結果は男女比に偏りがないと言えるか。

  ||男性|女性|
  |:--:|:--:|:--:|
  |度数（観測値）|42|58|

* ここで100人のアンケートにおける男女比の理論値は 50対50 であるとします。

  ||男性|女性|
  |:--:|:--:|:--:|
  |度数（観測値）|42|58|
  |度数（理論値）|50|50|

* 以降は観測値と理論値から仮説検定を行います。仮説検定の手順は以下のとおりです。

  ```
  1. 帰無仮説・対立仮説を定義する
  2. 検定統計量を定義する
  3. 有意水準（α）を定義する
  4. 標本から検定統計量の実現値を算出して検証する
  ```

### 1. 帰無仮説・対立仮説を定義する

* 帰無仮説（H0）
  * 男女比の観測値は理論値（50:50）に等しい（理論値と差がない）
* 対立仮説（H1）
  * 男女比の観測値は理論値（50:50）に等しくない（理論値と差がある）

### 2. 検定統計量を定義する

* 検定統計量： χ2値

  <img src="img/530.png?" width="280px">

### 3. 有意水準（α）を定義する

* 有意水準（α）： 5% 片側検定

### 4. 標本から検定統計量の実現値を算出して検証する

||男性|女性|
|:--:|:--:|:--:|
|度数（観測値）|42|58|
|度数（理論値）|50|50|


* 自由度1の95%点のカイ二乗値は3.841 である

  <img src="img/532.png?" width="400px">


#### Rプログラム

```r
o <- c(42, 58)
e <- c(50, 50)
c2 <- sum((o - e)^2 / e)
paste("chisq: ", c2)
paste("95% chisq: ", qchisq(0.95, df = 1))
paste("p-value:", pchisq(c2, df = 1, lower.tail = F))
```

#### 実行結果

```r
> o <- c(42, 58)
> e <- c(50, 50)
> c2 <- sum((o - e)^2 / e)
> paste("chisq: ", c2)
[1] "chisq:  2.56"
> paste("95% chisq: ", qchisq(0.95, df = 1))
[1] "95% chisq:  3.84145882069412"
> paste("p-value:", pchisq(c2, df = 1, lower.tail = F))
[1] "p-value: 0.109598583399116"
```

#### 仮説検定

* 帰無仮説（H0）： 男女比の観測値は理論値（50:50）に等しい（理論値と差がない）
* 対立仮説（H1）： 男女比の観測値は理論値（50:50）に等しくない（理論値と差がある）
* 検定統計量： χ2値
* 有意水準： 5% 片側検定
* 標本：
    ||男性|女性|
    |:--:|:--:|:--:|
    |度数（観測値）|42|58|
    |度数（理論値）|50|50|
* 帰無分布： カイ二乗分布
* 臨界値： +3.84
* 棄却域： +3.84以上
* χ2値： 2.56 ※棄却域にない
* p値： 0.11
* 検定結果： 検定結果は5%水準で有意でない

以上の結果から、χ2値は棄却域にない（p値は有意水準5%を上回る）ため帰無仮説は棄却されない。

---

#### Rプログラム - 参考 `chisq.test` 関数

* `chisq.test` 関数はカイ二乗検定（適合度検定）を行う
* `chisq.test` 関数は第1引数に標本データ、引数 `p` に理論値の比率を指定する

```r
x <- c(42, 58)
chisq.test(x, p = c(0.5, 0.5))
```

> 理論値の比率が一定である場合、引数 `p` を省略しても構いません。

#### 実行結果

```r
> x <- c(42, 58)
> chisq.test(x, p = c(0.5, 0.5))

	Chi-squared test for given probabilities

data:  x
X-squared = 2.56, df = 1, p-value = 0.1096
```

---

## エクササイズ

### 設問1

サイコロを100回振ったところ、結果は以下のようになった。

||1|2|3|4|5|6|
|:--:|:--:|:--:|:--:|:--:|:--:|:--:|
|観測値|30|20|20|10|10|10|

このサイコロは不正なサイコロと言えるか。有意水準5%で仮説検定してください。

---

### 設問2

あるゲーム会社では以下の比率でカードを配布していると公表している。

||S|A|B|C|
|:--:|:--:|:--:|:--:|:--:|
|理論値|5%|15%|40%|40%|

実際に100枚カードを購入すると以下のようになった。

||S|A|B|C|
|:--:|:--:|:--:|:--:|:--:|
|観測値|5|20|40|35|

このゲーム会社の公表しているカードの配布率は妥当と言えるか。有意水準5%で仮説検定してください。

<!--

設問1

> x <- c(30, 20, 20, 10, 10, 10)
> chisq.test(x, p = c(1/6, 1/6, 1/6, 1/6, 1/6, 1/6))

	Chi-squared test for given probabilities

data:  x
X-squared = 20, df = 5, p-value = 0.00125

設問2

> x <- c(5, 20, 40, 35)
> chisq.test(x, p = c(5 / 100, 15 / 100, 40 / 100, 40 / 100))

	Chi-squared test for given probabilities

data:  x
X-squared = 2.2917, df = 3, p-value = 0.5141

> 

-->